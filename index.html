<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A lightweight browser-based chat interface that turns natural language prompts into executable JavaScript, powered by OpenAI GPT-4o.">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self'; connect-src https://api.openai.com; frame-src blob:; img-src 'self' data:;">
  <title>Agentic Chat</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>Agentic Chat</h2>

  <div class="toolbar" role="form" aria-label="API key entry">
    <label for="api-key" class="sr-only">OpenAI API Key</label>
    <input id="api-key" type="password" placeholder="OpenAI API Key" autocomplete="off">
  </div>

  <div class="toolbar" role="form" aria-label="Chat input">
    <label for="chat-input" class="sr-only">Your message</label>
    <input id="chat-input" placeholder="Ask anythingâ€¦" autocomplete="off">
    <button id="send-btn">Send</button>
    <button id="cancel-btn" class="btn-danger" style="display:none;" title="Cancel running sandbox execution">Cancel</button>
    <button id="clear-btn" class="btn-secondary" title="Clear conversation history">Clear</button>
    <button id="templates-btn" class="btn-secondary" title="Browse prompt templates">Templates</button>
    <button id="history-btn" class="btn-secondary" title="Toggle conversation history panel">History</button>
    <button id="snippets-btn" class="btn-secondary" title="Saved code snippets">Snippets</button>
    <button id="sessions-btn" class="btn-secondary" title="Chat sessions (Ctrl+J)">Sessions</button>
    <button id="shortcuts-btn" class="btn-secondary" title="Keyboard shortcuts (press ? for help)">âŒ¨ï¸</button>
    <button id="voice-btn" class="btn-secondary" title="Voice input â€” speak your prompt (Ctrl+M)" aria-label="Toggle voice input">ğŸ¤</button>
    <button id="theme-btn" class="btn-secondary" title="Switch to light theme (Ctrl+D)" aria-label="Toggle theme">â˜€ï¸</button>
  </div>

  <div id="char-count"></div>
  <div id="last-prompt">(no input yet)</div>

  <div id="blackbox">
    <div id="chat-output"></div>
    <div id="code-actions" style="display:none;">
      <button id="save-snippet-btn" class="btn-sm" title="Save this code snippet">ğŸ’¾ Save Snippet</button>
      <button id="copy-code-btn" class="btn-sm" title="Copy code to clipboard">ğŸ“‹ Copy</button>
      <button id="rerun-code-btn" class="btn-sm" title="Re-run this code">â–¶ï¸ Re-run</button>
    </div>
    <div id="console-output" aria-live="polite">(results appear here)</div>
    <div id="token-usage"></div>
  </div>

  <!-- Conversation History Overlay -->
  <div id="history-overlay"></div>

  <!-- Templates Panel -->
  <div id="templates-overlay"></div>
  <div id="templates-panel" aria-label="Prompt templates">
    <div id="templates-header">
      <span>Prompt Templates</span>
      <div id="templates-actions">
        <button id="templates-close-btn" class="btn-sm" title="Close panel">âœ•</button>
      </div>
    </div>
    <div id="templates-search-wrap">
      <input id="templates-search" type="text" placeholder="Search templatesâ€¦" autocomplete="off">
    </div>
    <div id="templates-list"></div>
  </div>

  <!-- Conversation History Panel -->
  <div id="history-panel" aria-label="Conversation history">
    <div id="history-header">
      <span>Conversation History</span>
      <div id="history-actions">
        <button id="export-md-btn" class="btn-sm" title="Export as Markdown">ğŸ“„ MD</button>
        <button id="export-json-btn" class="btn-sm" title="Export as JSON">ğŸ“‹ JSON</button>
        <button id="history-close-btn" class="btn-sm" title="Close panel">âœ•</button>
      </div>
    </div>
    <div id="history-messages"></div>
  </div>

  <!-- Snippets Panel -->
  <div id="snippets-overlay"></div>
  <div id="snippets-panel" aria-label="Saved code snippets">
    <div id="snippets-header">
      <span>ğŸ’¾ Saved Snippets</span>
      <div id="snippets-actions">
        <button id="snippets-clear-btn" class="btn-sm btn-danger-sm" title="Delete all snippets">Clear All</button>
        <button id="snippets-close-btn" class="btn-sm" title="Close panel">âœ•</button>
      </div>
    </div>
    <div id="snippets-search-wrap">
      <input id="snippets-search" type="text" placeholder="Search snippetsâ€¦" autocomplete="off">
    </div>
    <div id="snippets-count"></div>
    <div id="snippets-list"></div>
  </div>

  <!-- Sessions Panel -->
  <div id="sessions-overlay"></div>
  <div id="sessions-panel" aria-label="Chat sessions">
    <div id="sessions-header">
      <span>ğŸ’¬ Chat Sessions</span>
      <div id="sessions-actions">
        <button id="sessions-close-btn" class="btn-sm" title="Close panel">âœ•</button>
      </div>
    </div>
    <div id="sessions-toolbar">
      <button id="sessions-new-btn" class="btn-sm" title="Start new session (Ctrl+N)">â• New</button>
      <button id="sessions-save-btn" class="btn-sm" title="Save current session">ğŸ’¾ Save</button>
      <button id="sessions-import-btn" class="btn-sm" title="Import session from JSON">ğŸ“¥ Import</button>
      <button id="sessions-clear-btn" class="btn-sm btn-danger-sm" title="Delete all sessions">Clear All</button>
      <label class="sessions-autosave-label" title="Auto-save after each message">
        <input type="checkbox" id="sessions-autosave">
        Auto-save
      </label>
    </div>
    <div id="sessions-count"></div>
    <div id="sessions-list"></div>
  </div>

  <!-- Session Save Dialog -->
  <div id="session-save-modal" role="dialog" aria-modal="true" aria-labelledby="session-modal-title">
    <div id="session-save-content">
      <p id="session-modal-title"><strong>Save Session</strong></p>
      <label for="session-name-input">Session Name</label>
      <input id="session-name-input" type="text" placeholder="e.g. API Integration Test" autocomplete="off">
      <div id="session-modal-buttons">
        <button id="session-save-cancel" class="btn-secondary">Cancel</button>
        <button id="session-save-confirm">Save</button>
      </div>
    </div>
  </div>

  <!-- API Key Modal -->
  <div id="apikey-modal" role="dialog" aria-modal="true" aria-labelledby="api-modal-title">
    <div id="apikey-modal-content">
      <p id="api-modal-title">API key needed for<br><strong id="api-service-name"></strong></p>
      <label for="user-api-key" class="sr-only">Service API key</label>
      <input id="user-api-key" type="password" placeholder="Paste key" autocomplete="off">
      <br><br>
      <button id="apikey-submit-btn">OK</button>
    </div>
  </div>

  <!-- Save Snippet Dialog -->
  <div id="snippet-save-modal" role="dialog" aria-modal="true" aria-labelledby="snippet-modal-title">
    <div id="snippet-save-content">
      <p id="snippet-modal-title"><strong>Save Code Snippet</strong></p>
      <label for="snippet-name-input">Name</label>
      <input id="snippet-name-input" type="text" placeholder="e.g. Bar Chart Generator" autocomplete="off">
      <label for="snippet-tags-input">Tags <span class="label-hint">(comma-separated, optional)</span></label>
      <input id="snippet-tags-input" type="text" placeholder="e.g. chart, canvas, data" autocomplete="off">
      <div id="snippet-code-preview"></div>
      <div id="snippet-modal-buttons">
        <button id="snippet-cancel-btn" class="btn-secondary">Cancel</button>
        <button id="snippet-confirm-btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Keyboard Shortcuts Help Modal -->
  <div id="shortcuts-modal" role="dialog" aria-modal="true" aria-labelledby="shortcuts-modal-title">
    <div id="shortcuts-modal-content">
      <div id="shortcuts-modal-header">
        <span id="shortcuts-modal-title">âŒ¨ï¸ Keyboard Shortcuts</span>
        <button id="shortcuts-modal-close" class="btn-sm" title="Close">âœ•</button>
      </div>
      <div id="shortcuts-list">
        <div class="shortcut-group">
          <div class="shortcut-group-title">Chat</div>
          <div class="shortcut-row"><kbd>Enter</kbd><span>Send message</span></div>
          <div class="shortcut-row"><kbd>Ctrl</kbd> + <kbd>L</kbd><span>Clear conversation</span></div>
          <div class="shortcut-row"><kbd>Ctrl</kbd> + <kbd>K</kbd><span>Focus chat input</span></div>
        </div>
        <div class="shortcut-group">
          <div class="shortcut-group-title">Panels</div>
          <div class="shortcut-row"><kbd>Ctrl</kbd> + <kbd>H</kbd><span>Toggle history</span></div>
          <div class="shortcut-row"><kbd>Ctrl</kbd> + <kbd>T</kbd><span>Toggle templates</span></div>
          <div class="shortcut-row"><kbd>Ctrl</kbd> + <kbd>S</kbd><span>Toggle snippets</span></div>
          <div class="shortcut-row"><kbd>Ctrl</kbd> + <kbd>J</kbd><span>Toggle sessions</span></div>
        </div>
        <div class="shortcut-group">
          <div class="shortcut-group-title">Sessions</div>
          <div class="shortcut-row"><kbd>Ctrl</kbd> + <kbd>N</kbd><span>New session</span></div>
        </div>
        <div class="shortcut-group">
          <div class="shortcut-group-title">Voice</div>
          <div class="shortcut-row"><kbd>Ctrl</kbd> + <kbd>M</kbd><span>Toggle voice input</span></div>
        </div>
        <div class="shortcut-group">
          <div class="shortcut-group-title">Appearance</div>
          <div class="shortcut-row"><kbd>Ctrl</kbd> + <kbd>D</kbd><span>Toggle dark / light theme</span></div>
        </div>
        <div class="shortcut-group">
          <div class="shortcut-group-title">General</div>
          <div class="shortcut-row"><kbd>?</kbd><span>Show this help</span></div>
          <div class="shortcut-row"><kbd>Escape</kbd><span>Close any panel / modal</span></div>
        </div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
