<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A lightweight browser-based chat interface that turns natural language prompts into executable JavaScript, powered by OpenAI GPT-4o.">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self'; connect-src https://api.openai.com; frame-src blob:; img-src 'self' data:;">
  <title>Agentic Chat</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>Agentic Chat</h2>

  <div class="toolbar" role="form" aria-label="API key entry">
    <label for="api-key" class="sr-only">OpenAI API Key</label>
    <input id="api-key" type="password" placeholder="OpenAI API Key" autocomplete="off">
  </div>

  <div class="toolbar" role="form" aria-label="Chat input">
    <label for="chat-input" class="sr-only">Your message</label>
    <input id="chat-input" placeholder="Ask anythingâ€¦" autocomplete="off">
    <button id="send-btn">Send</button>
    <button id="cancel-btn" class="btn-danger" style="display:none;" title="Cancel running sandbox execution">Cancel</button>
    <button id="clear-btn" class="btn-secondary" title="Clear conversation history">Clear</button>
    <button id="history-btn" class="btn-secondary" title="Toggle conversation history panel">History</button>
  </div>

  <div id="char-count"></div>
  <div id="last-prompt">(no input yet)</div>

  <div id="blackbox">
    <div id="chat-output"></div>
    <div id="console-output" aria-live="polite">(results appear here)</div>
    <div id="token-usage"></div>
  </div>

  <!-- Conversation History Overlay -->
  <div id="history-overlay"></div>

  <!-- Conversation History Panel -->
  <div id="history-panel" aria-label="Conversation history">
    <div id="history-header">
      <span>Conversation History</span>
      <div id="history-actions">
        <button id="export-md-btn" class="btn-sm" title="Export as Markdown">ðŸ“„ MD</button>
        <button id="export-json-btn" class="btn-sm" title="Export as JSON">ðŸ“‹ JSON</button>
        <button id="history-close-btn" class="btn-sm" title="Close panel">âœ•</button>
      </div>
    </div>
    <div id="history-messages"></div>
  </div>

  <!-- API Key Modal -->
  <div id="apikey-modal" role="dialog" aria-modal="true" aria-labelledby="api-modal-title">
    <div id="apikey-modal-content">
      <p id="api-modal-title">API key needed for<br><strong id="api-service-name"></strong></p>
      <label for="user-api-key" class="sr-only">Service API key</label>
      <input id="user-api-key" type="password" placeholder="Paste key" autocomplete="off">
      <br><br>
      <button id="apikey-submit-btn">OK</button>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
